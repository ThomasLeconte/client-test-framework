# Client Test Framework

> Projet réalisé dans le cadre de l'UE GLG101 (Test et Validation du Logiciel) par **Thomas Leconte** et **Alexis Leroux**.

Ce framework est basé sur la technologie WebDriver, qui permet de contrôler automatiquement un navigateur internet grâce
à une API. Ici, la bibliothèque Selenium WebDriver est utilisée pour piloter notre navigateur.

## Table des matières ##
[Fonctionnalités principales](#fonctionnalités-principales)  
&nbsp;&nbsp;&nbsp;&nbsp;[Méthodes utiles](#methodes-utiles)  
&nbsp;&nbsp;&nbsp;&nbsp;[Instancier une nouvelle page](#instancier-une-nouvelle-page)  
&nbsp;&nbsp;&nbsp;&nbsp;[Référencement d'élément](#référencement-délément)  
&nbsp;&nbsp;&nbsp;&nbsp;[Jeux de données](#jeux-de-données)  
[Pour le développeur](#pour-le-développeur)  
[Pour le testeur](#pour-le-testeur)

## Fonctionnalités principales

### Methodes utiles

**<...> = arguments obligatoires**  
**[...] = arguments optionnels**

> nouvelOnglet([String url]) - Ouvre un nouvel onglet sur la même fenêtre du navigateur actuel.

> allerSurOnglet(int indexOnglet) - Sélectionne un onglet parmis ceux qui sont disponibles grâce à son index dans la liste des onglets.

> pagePrecedente() - Retourner sur la page précédente.

> pageSuivante() - Retourner sur la page suivante.

> raffraichir() - Raffraichir la page actuelle.

> supprimerCookies() - Supprimme l'ensemble des cookies du navigateur.

> modifierTailleEcran(int largeur, int longueur) - Redimensionne la fenêtre actuelle avec des dimensions personnalisées.

> ajouterReferenceMobile(String nom, int hauteur, int largeur) - Déclarer un téléphone avec des dimensions personnalisées.

> passerEnModeMobile([String referenceTelephone]) - Redmimensionne la fenêtre pour lui donner l'apparence d'un écran de smartphone.

> viderChamps(String referenceChamps) - vide le champs d'un formulaire.

> remplirChamps(String referenceChamps, String valeur) - Rempli un champs avec la valeur spécifiée en le ciblant grâce à sa référence.

> attendre(int nbSecondes) - Permet d'attendre pendant X secondes durant l'exécution.

> selectionnerValeurDansListe(String referenceListe, String valeur) - Sélectionne une valeur parmis celles disponibles dans une liste déroulante.

> clicSurBouton(referenceBouton) - Clique sur un bouton grâce à sa référence.

> verifierPresenceValeurDansTableau(String valeur) - Renvoie un booléen confirmant la présence d'une valeur parmis les tableaux disponibles sur la page.

> verifierPresenceElement(String referenceElement) - Contrôle la présence d'un élément sur une page grâce à sa référence.

> getDonnee(String cheminJSON) - Récupère la valeur d'une donnée JSON grâce à son chemin hiérarchique dans le fichier de données.

> faireCaptureEcran(String dossierDestination) - Sauvegarde une capture d'écran de la page actuelle dans la destination ciblée.


### Instancier une nouvelle page

Il est possible de créer une page générique. Celle-ci possède les même fonctionnalités qu'une page spécifique. Voici
comment l'instancier :

`````java                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
Page p = new Page("maPage", "https://www.google.fr", driver, "cheminVersFichierReferences");
`````

Elle permet principalement de faire la transition entre deux pages spécifiques, lors d'une connexion par exemple. (
accueil &rarr; connexion &rarr; tableau de bord)

### Référencement d'élément

Cette fonctionnalité permet de mettre un nom à des éléments d'une application WEB grâce à une jonction entre le nom et
le lien XPath de l'élément. Cette jonction permettra de récupérer l'élément en question pour pouvoir le manipuler ou
contrôler ses attributs.

**Implémentation :**

- Créer un fichier JSON permettant de référencer vos éléments à l'endroit que vous voulez. Ensuite, vous devrez
  respecter une structure précise :

```json
{
  "pages": [
    {
      "nom": "nomDeVotrePage",
      "references": {
        "nomDeVotreReference": "CheminXPathVersVotreElement",
        "addComputerBtn": "//*[@id=\"add\"]",
        "rechercheOrdinateur": "//form/input[@id='searchbox']",
        "rechercheOrdinateurBtn": "//form/input[@id='searchsubmit']",
        "alerteSuccesCreation": "//section//div[@class='alert-message warning' and contains(., 'has been created')]"
      }
    },
    ...
}
```
Il se peut que durant l'execution d'un test, vous vouliez ajouter une référence dynamiquement. Pour se faire, vous pouvez
utiliser la méthode `ajouterReferenceDynamique(String nomReference, String xPath)`.

Egalement, dans le cas d'un changement de page, les références enregistrées peuvent ne plus correspondre à ce qu'il y a sur la page. Vous
pouvez donc mettre à jour les références de la page via la méthode `mettreAJourReferences(String nomPage)` pour charger les références de votre
nouvelle page.

### Jeux de données
Pour accompagner vos tests, un module de lecture de données est également disponible. Pour l'activer, vous devez l'ajouter
avec la méthode `ajouterLecteurDonnees(String cheminFichier)` depuis l'instanciation de votre
page.

Le fichier hébergant les données peut avoir n'importe quelle structure. Prenons l'exemple suivant :
```json
{
  "ordinateurs": [
    {
      "nom": "MacBook",
      "dateDebut": "2006-05-16",
      "dateFin": "-",
      "compagnie": "Apple Inc."
    }
  ]
}
```
Pour récupérer la valeur de `dateFin` du premier ordinateur, il suffit d'utiliser la méthode `getDonnee(String cheminJSON)` depuis une de vos pages :
```java
Page p = new Page("maPage", "https://www.google.fr", driver, "cheminVersFichierReferences");
p.ajouterLecteurDonnees("cheminVersFichierDonnees");
p.getDonnee("ordinateurs/0/dateFin");
```

## Pour le développeur

Le développeur peut concevoir des fonctions métier à destination du testeur.
Les fonctions ont pour but d'effectuer une suite d'actions avec un simple appel.
Le testeur peut s'épargner des conditions longue dans ses tests.

Il est nécessaire de déclarer sa fonction avec les annotations concuber pour qu'elle soit utilisable par le testeur.

Exemple d'une fonction permettant de vérifier la présence d'une référence sur la page "panier" du site Actimac.

```java
    @And("Je verifie la présence de {string} dans le panier")
    public void jeCharge(String nomProduit){
        try {
            page = new Page("Panier", "https://www.actimag.biz/panier",  driver, REF_PATH);
            WebElement Element = page.recupElementParReference("titreArticle");
            assertEquals(Element.getText(), nomProduit);
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }
        catch (Exception e) {
            e.printStackTrace();
        }
    }
```

## Pour le testeur

Pour concevoir vos tests, voici un exemple pas à pas avec un scénario simple.

Tout d'abord nous devons créer un fichier avec l'extension .feature à l'emplacement suivant :

src/test/resources/DemoReadme.feature

Ce fichier feature contiendra nos scénarios de tests.

Objectifs du test :

- Se rendre sur le site https://www.actimag.biz/
- Cliquer dans le menu sur "Iphone"
- Cliquer dans le sous-menu "Iphone 13"
- Cliquer sur le bouton "Acheter un Iphone 13 pro"
- Choisir la couleur "OR"
- Ajouter au panier
- Vérifier l'ajout au panier

```java
Feature: DemoReadme //Nom de notre feature


@BeforeInitDriver // Initialisation avant tout de notre driver chrome
@AfterFermerFenetre // Fermeture de la fenetre à la fin de l'exécution du scénario

Scenario: Ajouter un iphone 13 pro au panier // Nom de notre scénario

        // Chargement du site web
        Given Je suis sur le site "https://www.actimag.biz/"
```
![Url actimag](img-readme/Actimagurl.png)
```java
        // Délais d'attente pour être sur que la page soit bien chargé (+/- long en fonction de la connexion)
        Then J'attends 2 seconde
        //Définition du xpath de l'élement
        And Je definis l'element "menuIphone" avec la référence "/html/body/main/header/div[3]/div/div/ul/li[5]"
 ```
![Url actimag](img-readme/Menuiphone.png)

 ```java       
        //Clique sur le menu "Iphone"
        Then Je clique sur le bouton de reference "menuIphone"
        
        Then J'attends 2 seconde
        
        And  Je definis l'element "Iphone13" avec la référence "/html/body/main/header/div[3]/div/div/ul/li[5]/div/table/tbody/tr/td[2]/div/div[2]/span/a"
``` 

![Url actimag](img-readme/Sousmenuiphone.png)

```java
        Then J'attends 2 seconde
        Then Je clique sur le bouton de reference "Iphone13"
``` 

```java
        And Je definis l'element "boutonAcheterIphone13Pro" avec la référence "/html/body/main/section/div/div[2]/div/div[2]/div/div[8]/div/div[2]/div/div/div/div/div/div[4]/div/div[4]/div/a"
        Then J'attends 2 seconde
``` 
![Url actimag](img-readme/BtnAcheteriphone.png)

```java
        Then Je clique sur le bouton de reference "boutonAcheterIphone13Pro"
        And Je definis l'element "couleurOr" avec la référence "/html/body/main/section/div/div[2]/section/div[1]/div/div[2]/div[3]/div[1]/form/div[1]/div[1]/ul/li[2]/label/input"
        Then J'attends 2 seconde
```
![Url actimag](img-readme/Couleuriphone.png)

```java
        Then Je clique sur le bouton de reference "couleurOr"
        And Je definis l'element "boutonAjouterPanier" avec la référence "/html/body/main/section/div/div[2]/section/div[1]/div/div[2]/div[3]/div[1]/form/div[2]/div/div/button"
        Then Je clique sur le bouton de reference "boutonAjouterPanier"
        Then J'attends 2 seconde
```


```java
        And L'élément avec le xpath "/html/body/div[2]/div/div/div[1]/h4/text()" existe
```
![Url actimag](img-readme/panier.png)